<!DOCTYPE html>
<html lang="es">

<head>
    <title>Hack the Box:P.O.O.</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width-device-width, initial-scale-1">

    <!--  Import the webpage's stylesheet  -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=BioRhyme:wght@800&family=Space+Mono&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link href="../style.css" rel="stylesheet">
</head>

<body style="background-color: darkgrey;">
    <headear>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark justify-content-end">
            <a class="navbar-brand" href="../index.html">
                <img src="../img/Brand.jpg" width="30" height="30" alt="" class="rounded"></a>
            <ul class="nav ">
                <li class="nav-item active">
                    <a class="nav-link" href="../index.html">Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../htb/index.html">HackTheBox</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">Acerca de</a>
                </li>
        </nav>
        <div class="cover d-flex justify-content-end align-items-start flex-column p-5">
            <h1>RC1991</h1>
            <p>Writeups para CTF's</p>
            <form action="../htb/index.html" method="get" id="Index"></form>
            <button class="btn btn-dark" type="submit" form="Index" value="Submit">Hack the Box</button>
        </div>
    </headear>

    <section>
        <div class="container mt-3 mb-3 redaccion">

            <h1>P.O.O</h1>
            <hr>
            <img class="rounded mx-auto d-block mb-3" src="img/poo/poo_cards.png">
            <p>La maquina P.O.O es un Windows Server que cuenta con dos servicios en ejecucion y aque a ademas esta
                enrolada a un servidor de dominio Windows Server "DC.intranet.poo"
                en una red interna (172.20.128.53), el objetivo de la prueba de intrusion es conseguir acceso al
                servidor que administra el dominio con una cuenta que permtenesca al gurpo de administradores
                del dominio.</p>
            <p>Informacion Basica</p>
            <ul>
                <li><b>OS: </b>Acceso: Windows Server</li>
                <li><b>IP: </b>10.13.38.11</li>
                <br>
                <li><b>OS: </b>DC: Windows Server </li>
                <li><b>IP: </b>172.20.128.53</li>
            </ul>
            <h3>Enumeracion</h3>
            <hr>
            <p>Se realiza un escaneo sobre el dispositivo en busca de todos los puertos activos en el equipo remoto
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                <span>fastTCPScan -host 10.13.38.11</span></code>
            </div><img class="rounded mx-auto mb-3" src="https://i.ibb.co/c61qPBs/test.png"></p>
            <p>Una vez detectados los puertos abiertos se pueden escanear para determinar los servicios y las
                versisiones que se estan ejecutando.
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>nmap 10.13.38.11 -p80,1433 -sC -sV -n --min-rate 5400 -T5 -oN BasicScan_10.13.38.11.txt  </span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="https://i.ibb.co/YZYDH3Z/poo-nmap.png"></p>
            <p>El escaneo detecta que se esta ejecutando dos servicios, una pagina web y una BD MS-SQL,<br>
                tambien se puede observar el nombre del equipo remoto a si como el dominio en el eque se encuentra.
            <ul>
                <li><b>Hostname: </b>compatibility</li>
                <li><b>Dominio: </b>intranet.poo</li>
            </ul>
            </p>


            <h3>Enumeracion Web</h3>
            <hr>
            <p>Al ingresar al servicio web se despliega una pagina por defecto para el servisio IIS
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>http://10.13.38.11/</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="https://i.ibb.co/hYjY22q/poo-url.png"></p>
            <p>Se utiliza la herramienta "Whatweb" para determinar informacion relevante sobre el servicio web a demas
                de la herramienta "Nikto" para buscar vulnerabilidades en el servici,
                a si como "dirsearch" para reazliar la busqueda de directorios ocultos<br>
                para una mejor enumeracion, se agrego la resolucion de nombres al direcotiro "/etc/hosts"
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>cat /etc/hosts</span></code>
            </div><img class="rounded mx-auto mb-3" src="https://i.ibb.co/Z8W4ZSn/poo-hots.png">
            <br>

            Whatweb
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>whatweb -a3 http://intranet.poo</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="https://i.ibb.co/VphpzL1/poo-what.png"></p>
            <p>Nikto
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>nikto -host=http://intranet.poo </span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_nikto.PNG"></p>

            <div style="border-style: double;">
                <p><b>Nota </b><br>
                    Los archivos .DS_Store los crea el sistema operativo Mac OS X en cualquier directorio (incluyendo
                    carpetas de red)<br>
                    que se abra con Finder de Mac, y su función es la de “memorizar” la posición de los iconos y el
                    fondo de las carpetas.<br>
                    Bajo OS X estos ficheros están ocultos y por regla general no se ven, pero desde Windows o Linux los
                    veremos en todos los directorios que previamente hayamos visualizado
                </p>
            </div>
            <p><br>Nikto nos muestra que el servicio web cuenta con multiples archivos ".DS_Store"
                y que pueden contener informacion relevante sobre el servicio. Con la herramienta dirsearch podermos
                encontrar estos directorios.
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                   <span>dirsearch -u http://10.13.38.11/ --full-url -x 400,500 --threads=100 -r --recursion-depth 1 --extensions=html,txt,php,aspx --random-agent --simple-report=dirsearch_10.13.38.11.txt</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="https://i.ibb.co/5KJWJcZ/poo-dirsearch.png">
            </p>
            <p>El contenido de los archivos DS_store usando la herramienta " ds_store_exp.py".
                Esta herraminta se puede en contrar en el github <a
                    href="https://github.com/lijiejie/ds_store_exp">https://github.com/lijiejie/ds_store_exp</a>
                <br><br>
                Obteniendo herramienta
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                <span>wget https://raw.githubusercontent.com/lijiejie/ds_store_exp/master/ds_store_exp.py</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_github.png"></p>
            <p>Validando script
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                <span>python ds_store_exp.py</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_val.png"></p>
            <p>utilizaremos el script "ds_store_exp.py" con las URL'S encontradas con la herramienta dirsearch que contenian archivos
                .DS_Store
            <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                <span>cat dirsearch_10.13.38.11.txt | grep -i ds_store</span></code>
            </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_ds_store.png"></p>
            <p>Para automatizar la tarea crearemos un ciclo for para usar cada URL'S con el script,
                las URL'S relevantes son aquellas que marcan el codigo de respuesta 200
                <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>for string in $(cat dirsearch_10.13.38.11.txt);do python ds_store_exp.py $string;done</span></code>
                </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_ds_store_dev.png"></p>


            <h3>Explotacion 1</h3>
            <hr>

            <p> Utilizaremos la herramienta "iis_shortname_scanner.jar" con los directorios nuevos encontrados con el script "ds_store_exp.py" que contengan el archivo ".DS_Store" 
                y hallan resultado con el codigo de respuesta 200  para visualizar su contenido.           
            <div style="border-style: double;">
                <p><b>Nota </b><br>
                    la herramienta "iis_shortname_scanner.jar" se aprovecha de la vulnerabiliad Microsoft IIS tilde character “~” , esta vulnrabilidad permite enumerar
                    archivos dentro de cada directorio descubierto, la principal limitacion de esta vulnerabiliad es que solo puede mostrar 
                    los primeros 6 caracteres de un archivo y los primeos 3 de un directorio y solo puede ser usada en servicios servicios IIS compatibles con directorios NTFS.<br><br>
                    <b>Nota adicional</b><br>
                    Los archivos y directorios encontrados se encontraran en un formato conocido como “Windows 8.3 filenames”
                </p></div> </p>
            <p> Lo primero sera conseguir la herrmaienta <a href="https://github.com/irsdl/IIS-ShortName-Scanner">iis_shortname_scanner.jar</a>,
                <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>git clone https://github.com/irsdl/IIS-ShortName-Scanner.git</span></code>
                </div><img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_git.png"></p>
            <p>Una ves conseguida la herramienta se requeire validar que la URL sea vulnerable a este ataque, 
                esto se puede reazliar con el mismo script<br><br>

                Validacion vulnerabiliad
                <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>java -jar iis_shortname_scanner.jar http://10.13.38.11/ 2>/dev/null</span></code></div>
                    <img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_vuln.png"></p>
            <p> Confirmada la vulnerabiliad se lanzara el etaque sobre cada URL<br><br>
                Ejecucion de exploit
                <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/ 2>/dev/null</span></code></div>
                    <img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_exp1.png"></p>
            <p>Explorando las URLs se encuntrara que el directorio "http://10.13.38.11/dev/304c0c90fbc6520610abbf378e2339d1/db/" contiene un archivo 
                que coincide con el nombre del desafio "<b>poo</b>_co~1.txt"
                <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                    <span>java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/304c0c90fbc6520610abbf378e2339d1/db/ 2>/dev/null</span></code></div>
                    <img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_poo.png"></p>
                    <div style="border-style: double;">
                        <p><b>Nota </b><br>
                           Esta explotacion tambien se puede realizar de manera automatizada 
                           <div class="container border border-success mb-3" style="background-color: #fdf6e3;"><code>
                            <span>java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/304c0c90fbc6520610abbf378e2339d1/db/ 2>/dev/null</span></code></div>
                            <img class="figure-img mig-fluid rounded desbordado" src="img/poo/poo_msf1.png"> 
                        asd
                        </p></div>
            

            
            
            
           


            




































        </div>

    </section>

</body>